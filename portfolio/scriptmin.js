 (()=>{const e=document.getElementById("preloader"),t=document.querySelector(".preloader-content"),n=document.querySelector(".page-header"),s=document.querySelector(".container"),o=document.getElementById("webcam"),a=document.querySelector(".webcam-container"),i=document.querySelectorAll(".media-link img"),r=document.querySelectorAll("[data-i18n-key]"),c=document.querySelector(".header-left"),l=document.getElementById("about-trigger"),d=document.getElementById("about-overlay"),u=document.getElementById("about-background"),m=document.getElementById("easter-egg-layer"),g={en:{welcomeMessage:"This site uses your webcam to enhance the experience. <br> Please don't be shy!",aboutLink:"whoami",easterEggLeftHeader:"what are you doing up so late?",easterEggRightHeader:"go to sleep!",aboutBio:'Director and photographer, born in \'98. I live in Rome, but my heart is in Genoa. <br> I work on short films, photographic projects and international film productions. <br> Also, there\'s a good chance I\'ll beat you at <a href="https://www.chess.com/member/lksmrkds" target="_blank" rel="noopener noreferrer">chess</a>.',copyright:"© 2025 Luigi Vacchelli. All rights reserved."},it:{welcomeMessage:"Questo sito richiede l'accesso alla webcam per essere più bello.<br> Non fate i timidi!",aboutLink:"chisono",easterEggLeftHeader:"cosa ci fai ancora in piedi?",easterEggRightHeader:"corri a letto!",aboutBio:'Regista e fotografo, classe \'98. Vivo a Roma, ma ho lasciato il cuore a Genova. <br> Lavoro a cortometraggi, progetti fotografici e produzioni cinematografiche internazionali. <br> Inoltre, ci sono buone probabilità che ti batta a <a href="https://www.chess.com/member/lksmrkds" target="_blank" rel="noopener noreferrer">scacchi</a>.',copyright:"© 2025 Luigi Vacchelli. Tutti i diritti riservati."}};function f(){d&&(d.classList.add("is-open"),document.documentElement.classList.add("overlay-active"),d.setAttribute("aria-hidden","false"),function(){const e=document.querySelector(".about-image");if(!e||!e.dataset.hiresSrc||"true"===e.dataset.isSwapped)return;const t=e.dataset.hiresSrc,n=new Image;n.src=t,n.onload=()=>{e.src=t,e.dataset.isSwapped="true"}}())}function h(){d&&(d.classList.remove("is-open"),document.documentElement.classList.remove("overlay-active"),d.setAttribute("aria-hidden","true"))}function v(){o&&a&&(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{o.srcObject=e}).catch(()=>{a.style.display="none"}):a.style.display="none")}function y(e){if(!e)return;const t=e.querySelector(".carousel-track");let n,s,o=Array.from(t.children),a=!1,i=!1;function r(){const t=e.scrollLeft,n=e.offsetWidth;o.forEach(e=>{const s=e.offsetLeft,o=e.offsetWidth;s<t+n+o&&s+o>t-o&&function(e){const t="IMG"===e.tagName?e:e.querySelector("img");if(t&&t.dataset.hiresSrc&&!t.dataset.isSwapped){const e=t.dataset.hiresSrc,n=new Image;n.src=e,n.onload=()=>{t.src=e,t.dataset.isSwapped="true"}}}(e)})}const c=t=>{t.preventDefault();const o=t.pageX-e.offsetLeft-n;e.scrollLeft=s-o},l=()=>{i=!1,e.classList.remove("active-drag"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l)};e.addEventListener("mousedown",t=>{t.preventDefault(),i=!0,e.classList.add("active-drag"),n=t.pageX-e.offsetLeft,s=e.scrollLeft,document.addEventListener("mousemove",c),document.addEventListener("mouseup",l)}),e.addEventListener("mouseleave",()=>{i&&l()});const d=o[0].cloneNode(!0),u=o[o.length-1].cloneNode(!0);let m;d.classList.add("clone"),u.classList.add("clone"),t.appendChild(d),t.insertBefore(u,o[0]),o=Array.from(t.children),setTimeout(()=>{t.style.transition="none",e.scrollLeft=e.querySelector(".carousel-item:not(.clone)").offsetLeft,t.style.transition="",r()},0);new IntersectionObserver((n,s)=>{n.forEach(n=>{n.isIntersecting&&(m=setTimeout(()=>{t.classList.add("has-peeked")},500),s.unobserve(e))})},{threshold:.75}).observe(e),e.addEventListener("scroll",function n(){m&&clearTimeout(m),t.classList.remove("has-peeked"),e.removeEventListener("scroll",n)},{once:!0,passive:!0}),e.addEventListener("scroll",()=>{if(r(),a)return;const n=e.querySelector(".carousel-item:not(.clone)"),s=o[o.length-2],i=n.offsetWidth;e.scrollLeft<n.offsetLeft-i/2?(a=!0,t.style.transition="none",e.scrollLeft=s.offsetLeft,t.style.transition="",setTimeout(()=>{a=!1},50)):e.scrollLeft>s.offsetLeft+i/2&&(a=!0,t.style.transition="none",e.scrollLeft=n.offsetLeft,t.style.transition="",setTimeout(()=>{a=!1},50))},{passive:!0})}let p=!1,L=!1;function b(){p&&L&&(document.body.classList.add("loading-finished"),document.body.classList.add("layout-ready"),setTimeout(()=>{e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"));const t=function(){const e=(new Date).getHours();if(e>=0&&e<6&&m){if(!c||!l)return!1;const e=c.textContent,t=l.textContent;m.classList.add("active"),m.setAttribute("aria-hidden","false"),document.body.classList.add("easter-egg-active"),n.style.transition="none",n.classList.add("visible"),n.offsetWidth;const s="it"===navigator.language.substring(0,2)?"it":"en";return c.textContent=g[s].easterEggLeftHeader,l.textContent=g[s].easterEggRightHeader,setTimeout(()=>{n.style.transition="",n.classList.remove("visible")},5e3),setTimeout(()=>{document.body.classList.remove("easter-egg-active"),c.textContent=e,l.textContent=t,n.classList.add("visible"),m.classList.remove("active"),m.setAttribute("aria-hidden","true"),v()},5e3),!0}return!1}();s&&s.classList.add("visible"),t||(n&&n.classList.add("visible"),v()),function(){if(!("IntersectionObserver"in window))return;const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,s=n.dataset.hiresSrc;if(s&&!n.dataset.isSwapped){const e=new Image;e.src=s,e.onload=()=>{n.src=s,n.dataset.isSwapped="true"},t.unobserve(n)}}})},{rootMargin:"200px"});i.forEach(t=>{t.dataset.hiresSrc&&e.observe(t)})}()},1100))}document.addEventListener("DOMContentLoaded",()=>{t&&t.classList.add("ready"),function(){const e="it"===navigator.language.substring(0,2)?"it":"en";r.forEach(t=>{const n=t.dataset.i18nKey,s=g[e][n];void 0!==s&&(t.innerHTML=s)})}(),i.forEach(e=>{const t=e.src,n=e.dataset.gallery?e.dataset.gallery.split(","):[],s=e.dataset.hiresGallery?e.dataset.hiresGallery.split(","):[];let o=0;0!==n.length&&e.addEventListener("click",()=>{let a;o=(o+1)%(n.length+1),a=0===o?"true"===e.dataset.isSwapped?e.dataset.hiresSrc:t:s.length>=o?s[o-1]:n[o-1],e.src=a})}),document.querySelectorAll(".spark-on-scroll").forEach(e=>{const t=document.createElement("canvas");t.className="spark-canvas",e.appendChild(t);const n=t.getContext("2d");t.width=t.offsetWidth,t.height=t.offsetHeight;let s=[],o=!1;function a(e){n.clearRect(0,0,t.width,t.height);for(let t=s.length-1;t>=0;t--){const o=s[t],a=e-o.startTime;if(a>=500){s.splice(t,1);continue}const i=a/500,r=i*(2-i),c=30*r,l=8*(1-r),d=o.x+c*Math.cos(o.angle),u=o.y+c*Math.sin(o.angle),m=o.x+(c+l)*Math.cos(o.angle),g=o.y+(c+l)*Math.sin(o.angle);n.strokeStyle="#F6C500",n.lineWidth=2,n.beginPath(),n.moveTo(d,u),n.lineTo(m,g),n.stroke()}s.length>0&&requestAnimationFrame(a)}function i(){if(o)return;const e=t.width/2,n=t.height/2,i=performance.now();for(let t=0;t<8;t++)s.push({x:e,y:n,angle:2*Math.PI*t/8,startTime:i});8===s.length&&requestAnimationFrame(a)}e.addEventListener("click",()=>{o=!0},{once:!0}),new IntersectionObserver((t,n)=>{t.forEach(t=>{t.isIntersecting&&(setTimeout(i,200),setTimeout(i,700),setTimeout(i,3200),setTimeout(i,3700),n.unobserve(e))})},{threshold:.9}).observe(e)}),function(){const e=document.getElementById("dolphin-toggle");if(!e)return;const t=e.querySelector(".video-normal"),n=e.querySelector(".video-pixelated");if(!t||!n)return;e.addEventListener("click",()=>{e.classList.toggle("is-pixelated")});const s=()=>{t.readyState>=3&&n.readyState>=3&&(t.currentTime=0,n.currentTime=0,Promise.all([t.play(),n.play()]).catch(e=>console.warn("Automatic sync start failed:",e)))};t.readyState>=3&&n.readyState>=3?s():(t.addEventListener("canplay",s,{once:!0}),n.addEventListener("canplay",s,{once:!0})),t.addEventListener("ended",()=>{t.currentTime=0,n.currentTime=0,n.play(),t.play()})}(),function(){const e=document.getElementById("pool-animation");if(!e)return;const t=e.querySelector(".pool-video");t&&(t.preload="auto",t.addEventListener("ended",()=>{setTimeout(()=>{e.classList.remove("is-playing")},50)}),e.addEventListener("click",()=>{if(e.classList.contains("is-playing"))return;e.classList.add("is-playing"),t.currentTime=0,t.muted=!1;const n=t.play();void 0!==n&&n.catch(e=>{console.warn("Autoplay prevented:",e)})}),l.addEventListener("click",()=>{t&&(t.pause(),e.classList.remove("is-playing"))}))}(),function(){const e=document.querySelector(".interactive-balls-container");if(!e)return;const t=e.querySelector(".balls-video");t&&(t.addEventListener("ended",()=>{setTimeout(()=>{e.classList.contains("is-playing")&&t.play()},3e3)}),e.addEventListener("click",()=>{e.classList.contains("is-playing")?(e.classList.remove("is-playing"),t.pause()):(e.classList.add("is-playing"),t.currentTime=0,t.play().catch(e=>console.warn("Balls video play failed",e)))}))}(),function(){const e=[...Array.from(document.querySelectorAll(".column.left .media-link img, .column.left .media-link video")).slice(0,3),...Array.from(document.querySelectorAll(".column.right .media-link img, .column.right .media-link video")).slice(0,3)];if(0===e.length)return p=!0,void b();const t=e.map(e=>new Promise(t=>{"IMG"===e.tagName&&e.complete||"VIDEO"===e.tagName&&e.readyState>=3?t():(e.addEventListener("load",t,{once:!0}),e.addEventListener("canplay",t,{once:!0}),e.addEventListener("error",t,{once:!0}))}));Promise.all(t).then(()=>{p||(p=!0,b())})}();document.querySelectorAll(".carousel-container").forEach(y),function(){if(!("IntersectionObserver"in window))return;const e=document.querySelector(".site-footer");if(!e)return;let t=!1,n=!1;const s=new IntersectionObserver(s=>{s.forEach(e=>{"left"===e.target.dataset.column&&(t=e.isIntersecting),"right"===e.target.dataset.column&&(n=e.isIntersecting)}),window.matchMedia("(min-width: 769px)").matches?e.classList.toggle("visible",t&&n):e.classList.toggle("visible",n)});document.querySelectorAll(".scroll-trigger").forEach(e=>s.observe(e))}(),l&&l.addEventListener("click",f),u&&u.addEventListener("click",h),document.addEventListener("keydown",e=>{"Escape"===e.key&&d.classList.contains("is-open")&&h()})}),setTimeout(()=>{L=!0,b()},4e3),window.addEventListener("load",()=>{p||(p=!0,b())})})();

//  Created by Luigi Vacchelli on 22/11/25.
